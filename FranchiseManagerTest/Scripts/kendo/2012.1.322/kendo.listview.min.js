/*
* Kendo UI Web v2012.1.322 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at http://kendoui.com/web-license
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
(function(a,b){var c=window.kendo,d="change",e="dataBound",f="dataBinding",g=c.ui.Widget,h=c.keys,i=">*",d="change",j="requestStart",k="error",l="k-state-focused",m="k-focusable",n="k-state-selected",o="k-edit-item",p="string",q="click",r="edit",s="remove",t=a.proxy,u=c.ui.progress,v=c.data.DataSource,w=g.extend({init:function(b,d){var e=this;d=a.isArray(d)?{data:d}:d,g.fn.init.call(e,b,d),d=e.options,e.wrapper=e.element,e._element(),e._dataSource(),e.template=c.template(d.template||""),e.altTemplate=c.template(d.altTemplate||d.template),e.editTemplate=c.template(d.editTemplate||""),e._navigatable(),e._selectable(),e.options.autoBind&&e.dataSource.fetch(),c.notify(e)},events:[d,f,e,r,s],options:{name:"ListView",autoBind:!0,template:"",altTemplate:"",editTemplate:""},items:function(){return this.element.find(i)},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),a.fetch()},_dataSource:function(){var a=this;a.dataSource&&a._refreshHandler?a.dataSource.unbind(d,a._refreshHandler).unbind(j,a._requestStartHandler).unbind(k,a._errorHandler):(a._refreshHandler=t(a.refresh,a),a._requestStartHandler=t(a._requestStart,a),a._errorHandler=t(a._error,a)),a.dataSource=v.create(a.options.dataSource).bind(d,a._refreshHandler).bind(j,a._requestStartHandler).bind(k,a._errorHandler)},_requestStart:function(){u(this.element,!0)},_error:function(){u(this.element,!1)},_element:function(){this.element.addClass("k-widget k-listview")},refresh:function(a){var b=this,c=b.dataSource.view(),d="",g,h,i=b.template,j=b.altTemplate;if(!a||a.action!=="itemchange"||!b.editable){b.trigger(f),b._destroyEditable();for(g=0,h=c.length;g<h;g++)g%2?d+=j(c[g]):d+=i(c[g]);b.element.html(d),b.trigger(e)}},_selectable:function(){var a=this,b,e,f=a.options.selectable,g=a.options.navigatable;f&&(b=typeof f===p&&f.toLowerCase().indexOf("multiple")>-1,a.selectable=new c.ui.Selectable(a.element,{multiple:b,filter:i,change:function(){a.trigger(d)}}),g&&a.element.keydown(function(c){c.keyCode===h.SPACEBAR&&(e=a.current(),c.preventDefault(),b?c.ctrlKey?e.hasClass(n)&&(e.removeClass(n),e=null):a.selectable.clear():a.selectable.clear(),a.selectable.value(e))}))},current:function(a){var c=this,d=c._current;a!==b&&a.length&&(!d||d[0]!==a[0])&&(a.addClass(l),d&&d.removeClass(l),c._current=a);return c._current},_navigatable:function(){var b=this,c=b.options.navigatable,d=b.element,e=t(b.current,b),f=function(b){e(a(b.currentTarget)),a(b.target).is(":button,a,:input,a>.k-icon,textarea")||d.focus()};c&&(d.attr("tabIndex",Math.max(d.attr("tabIndex")||0,0)),d.bind({focus:function(){var a=b._current;a&&a.is(":visible")?a.addClass(l):e(d.find(i).first())},focusout:function(){b._current&&b._current.removeClass(l)},keydown:function(a){var c=a.keyCode,e=b.current();h.UP===c?b.current(e?e.prev():d.find(i).first()):h.DOWN===c?b.current(e?e.next():d.find(i).first()):h.PAGEUP==c?(b._current=null,b.dataSource.page(b.dataSource.page()-1)):h.PAGEDOWN==c&&(b._current=null,b.dataSource.page(b.dataSource.page()+1))}}),d.addClass(m).delegate("."+m+i,"mousedown",f))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(d)},select:function(b){var c=this,d=c.selectable;b=a(b);if(b.length)d.options.multiple||(d.clear(),b=b.first()),d.value(b);else return d.value()},_destroyEditable:function(){var a=this;a.editable&&(a.editable.distroy(),delete a.editable)},_closeEditable:function(b){var c=this,d=c.editable,e,f,g=!0;d&&(b&&(g=d.end()),g&&(e=c.dataSource.view()[d.element.index()],f=a(c.template(e)),c._destroyEditable(),d.element.replaceWith(f)));return g},edit:function(b){var c=this,d=c.dataSource.view()[b.index()],e=a(c.editTemplate(d)).addClass(o);c.cancel(),b.replaceWith(e),c.editable=e.kendoEditable({model:d,clearContainer:!1,errorTemplate:!1}).data("kendoEditable"),c.trigger(r,{model:d,item:e})},save:function(){this._closeEditable(!0)&&this.dataSource.sync()},remove:function(a){var b=this,c=b.dataSource,d=c.view()[a.index()];b.trigger(s,{model:d,item:a})||(a.hide(),c.remove(d),c.sync())},add:function(){var a=this,b=a.dataSource,c=b.indexOf((b.view()||[])[0]);c<0&&(c=0),a.cancel(),b.insert(c,{}),a.edit(a.element.children().first())},cancel:function(){var a=this,b=a.dataSource,c,d=-1;a.editable&&(d=a.editable.element.index()),d!=-1&&(c=b.view()[d],b.cancelChanges(c),a._closeEditable(!1))}});c.ui.plugin(w)})(jQuery)